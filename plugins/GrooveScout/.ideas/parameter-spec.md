# Parameter Specification — GrooveScout

**Status:** LOCKED — Immutable during Stages 1–5 implementation.

**CRITICAL CONTRACT:** Parameter IDs, types, ranges, and defaults defined here
are the single source of truth. Do NOT change them without updating ALL stages.

**Generated by:** UI mockup finalization (ui-finalization-agent, v2)
**Generated date:** 2026-02-21
**Source:** v2-ui.yaml (finalized design) + parameter-spec-draft.md (reference)
**Range authority:** v2-ui.yaml overrides draft where ranges differ.

---

## Total Parameter Count

**Total: 15 APVTS parameters**
- Float: 9
- Choice: 1
- Bool: 5

---

## Parameter Definitions

### Kick Detection

---

#### kickSensitivity

- **ID:** `kickSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear (no skew)
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in KICK detection card (Sens row)
- **DSP Usage:** Onset detection threshold for kick drum band. Lower values detect quieter hits; higher values require stronger transients.

---

#### kickFreqLow

- **ID:** `kickFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 20.0 to 1000.0 Hz
- **Default:** 40.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew for AudioParameterFloat NormalisableRange)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in KICK card
- **DSP Usage:** Low cutoff of kick drum bandpass detection filter. Must always be less than kickFreqHigh. Validated in DSP before use.

---

#### kickFreqHigh

- **ID:** `kickFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 20.0 to 1000.0 Hz
- **Default:** 120.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in KICK card
- **DSP Usage:** High cutoff of kick drum bandpass detection filter. Must always be greater than kickFreqLow.

---

### Snare Detection

---

#### snareSensitivity

- **ID:** `snareSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in SNARE detection card (Sens row)
- **DSP Usage:** Onset detection threshold for snare drum band. Lower = more sensitive.

---

#### snareFreqLow

- **ID:** `snareFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 100.0 to 20000.0 Hz
- **Default:** 200.0 Hz
- **Skew Factor:** logarithmic (approximately 0.25 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in SNARE card
- **DSP Usage:** Low cutoff of snare drum bandpass detection filter. Must be less than snareFreqHigh.

---

#### snareFreqHigh

- **ID:** `snareFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 100.0 to 20000.0 Hz
- **Default:** 8000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.25 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in SNARE card
- **DSP Usage:** High cutoff of snare drum bandpass detection filter. Must be greater than snareFreqLow.

---

### Hihat Detection

---

#### hihatSensitivity

- **ID:** `hihatSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in HIHAT detection card (Sens row)
- **DSP Usage:** Onset detection threshold for hihat band. Lower = more sensitive.

---

#### hihatFreqLow

- **ID:** `hihatFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 1000.0 to 20000.0 Hz
- **Default:** 5000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in HIHAT card
- **DSP Usage:** Low cutoff of hihat bandpass detection filter. Must be less than hihatFreqHigh.

---

#### hihatFreqHigh

- **ID:** `hihatFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 1000.0 to 20000.0 Hz
- **Default:** 16000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in HIHAT card
- **DSP Usage:** High cutoff of hihat bandpass detection filter. Must be greater than hihatFreqLow.

---

### BPM Control

---

#### bpmMultiplier

- **ID:** `bpmMultiplier`
- **Type:** `AudioParameterChoice`
- **Choices:** `{"1/2x", "1x", "2x"}` (indices 0, 1, 2)
- **Default Index:** 1 (value `"1x"`)
- **UI Control:** Three chip buttons in analysis bar BPM row
- **DSP Usage:** Multiplier applied to detected raw BPM before display and DAW set.
  - `1/2x`: use when analysis detects double-time (e.g., 160 BPM for an 80 BPM track)
  - `1x`: pass-through (detected BPM = displayed BPM)
  - `2x`: use when analysis detects half-time (e.g., 80 BPM for a 160 BPM track)
- **APVTS note:** Choice parameter uses 1-based index internally (JUCE convention). JavaScript uses 0-based `data-mult` mapped to 1-based `setSelectedId`.

---

### Analysis Toggles

---

#### analyzeBPM

- **ID:** `analyzeBPM`
- **Type:** `AudioParameterBool`
- **Default:** `true`
- **UI Control:** Toggle switch in BPM result row (right side of analysis bar)
- **DSP Usage:** When false, BPM detection step is skipped during analysis run. BPM display remains at last known value or placeholder.

---

#### analyzeKey

- **ID:** `analyzeKey`
- **Type:** `AudioParameterBool`
- **Default:** `true`
- **UI Control:** Toggle switch in KEY result row (right side of analysis bar)
- **DSP Usage:** When false, key detection step is skipped during analysis run.

---

#### analyzeKick

- **ID:** `analyzeKick`
- **Type:** `AudioParameterBool`
- **Default:** `true`
- **UI Control:** Toggle switch in KICK card header
- **DSP Usage:** When false, kick onset detection and MIDI extraction are skipped. Kick MIDI clip tile remains in placeholder state. Also disables kick card controls (sensitivity and freq range sliders).

---

#### analyzeSnare

- **ID:** `analyzeSnare`
- **Type:** `AudioParameterBool`
- **Default:** `true`
- **UI Control:** Toggle switch in SNARE card header
- **DSP Usage:** When false, snare onset detection and MIDI extraction are skipped. Snare MIDI clip tile remains in placeholder state. Also disables snare card controls.

---

#### analyzeHihat

- **ID:** `analyzeHihat`
- **Type:** `AudioParameterBool`
- **Default:** `true`
- **UI Control:** Toggle switch in HIHAT card header
- **DSP Usage:** When false, hihat onset detection and MIDI extraction are skipped. Hihat MIDI clip tile remains in placeholder state. Also disables hihat card controls.

---

## Non-Parameter UI Elements

These are UI interactions and plugin state — NOT APVTS parameters.
They use native function bridge (window.juce.getNativeFunction) and timer polling.

| Element | Type | C++ Integration |
|---------|------|----------------|
| Analyze button | Trigger | `getNativeFunction("analyzeButtonPressed")()` → `audioProcessor.startAnalysis()` |
| Cancel button | Trigger | `getNativeFunction("cancelAnalysis")()` → `audioProcessor.cancelAnalysis()` |
| BPM display | Clickable output + timer | Shows `getDetectedBpm()` × multiplier; click calls `getNativeFunction("setBpmToDaw")()` |
| Key display | Timer-updated label | Shows `getDetectedKey()` string from processor |
| Progress bar | Timer-updated bar | Shows `getAnalysisProgress()` 0.0–1.0 during analysis |
| ROOT CHORD clip | Draggable tile | `getNativeFunction("startMidiDrag")("chord")` → drag root chord MIDI file |
| KICK clip | Draggable tile | `getNativeFunction("startMidiDrag")("kick")` |
| SNARE clip | Draggable tile | `getNativeFunction("startMidiDrag")("snare")` |
| HIHAT clip | Draggable tile | `getNativeFunction("startMidiDrag")("hihat")` |
| Detection settings accordion | Expand/collapse | Pure UI state (JS only, no JUCE parameter) |

---

## APVTS Registration Order

Parameters must be registered in this order in `createParameterLayout()` for
consistency across stages:

```cpp
// PluginProcessor.cpp — createParameterLayout()

// Float: Kick (3)
juce::AudioParameterFloat kickSensitivity("kickSensitivity", "Kick Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat kickFreqLow("kickFreqLow", "Kick Freq Low",
    juce::NormalisableRange<float>(20.0f, 1000.0f, 0.0f, 0.4f), 40.0f);

juce::AudioParameterFloat kickFreqHigh("kickFreqHigh", "Kick Freq High",
    juce::NormalisableRange<float>(20.0f, 1000.0f, 0.0f, 0.4f), 120.0f);

// Float: Snare (3)
juce::AudioParameterFloat snareSensitivity("snareSensitivity", "Snare Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat snareFreqLow("snareFreqLow", "Snare Freq Low",
    juce::NormalisableRange<float>(100.0f, 20000.0f, 0.0f, 0.25f), 200.0f);

juce::AudioParameterFloat snareFreqHigh("snareFreqHigh", "Snare Freq High",
    juce::NormalisableRange<float>(100.0f, 20000.0f, 0.0f, 0.25f), 8000.0f);

// Float: Hihat (3)
juce::AudioParameterFloat hihatSensitivity("hihatSensitivity", "Hihat Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat hihatFreqLow("hihatFreqLow", "Hihat Freq Low",
    juce::NormalisableRange<float>(1000.0f, 20000.0f, 0.0f, 0.4f), 5000.0f);

juce::AudioParameterFloat hihatFreqHigh("hihatFreqHigh", "Hihat Freq High",
    juce::NormalisableRange<float>(1000.0f, 20000.0f, 0.0f, 0.4f), 16000.0f);

// Choice: BPM Multiplier (1)
juce::AudioParameterChoice bpmMultiplier("bpmMultiplier", "BPM Multiplier",
    juce::StringArray{"1/2x", "1x", "2x"}, 1);

// Bool: Analysis toggles (5)
juce::AudioParameterBool analyzeBPM("analyzeBPM", "Analyze BPM", true);
juce::AudioParameterBool analyzeKey("analyzeKey", "Analyze Key", true);
juce::AudioParameterBool analyzeKick("analyzeKick", "Analyze Kick", true);
juce::AudioParameterBool analyzeSnare("analyzeSnare", "Analyze Snare", true);
juce::AudioParameterBool analyzeHihat("analyzeHihat", "Analyze Hihat", true);
```

---

## Validation Constraints

These constraints must be enforced in DSP code (not in APVTS — APVTS allows any in-range value independently):

1. `kickFreqLow < kickFreqHigh` — clamp or swap in `prepareToPlay()` and `processBlock()`
2. `snareFreqLow < snareFreqHigh` — same enforcement
3. `hihatFreqLow < hihatFreqHigh` — same enforcement
4. Minimum gap between low/high: recommend 10 Hz minimum for all bands
5. `bpmMultiplier` applied as: `displayBpm = detectedBpm * (0.5 / 1.0 / 2.0)` per index

---

## Draft vs. Finalized Spec — Range Differences

The following ranges were updated from the draft to match the finalized v2-ui.yaml:

| Parameter | Draft range | Finalized range | Change |
|-----------|------------|-----------------|--------|
| `kickFreqLow` | 20–500 Hz | 20–1000 Hz | max increased |
| `kickFreqHigh` | 50–1000 Hz | 20–1000 Hz | min decreased |
| `snareFreqLow` | 100–2000 Hz | 100–20000 Hz | max increased |
| `hihatFreqHigh` | 5000–20000 Hz | 1000–20000 Hz | min decreased |

The v2-ui.yaml finalized design is authoritative. All stages use these ranges.

---

## Notes

- Parameters persist with preset save/load via APVTS serialization (automatic)
- Non-parameter state (analysis results: BPM, key, MIDI patterns) is ephemeral — not saved in presets
- Analysis results reset when plugin is reloaded or DAW project closes
- `getLatencySamples()` returns 0 — audio passes through unchanged (stereo passthrough)
- Plugin type: Analysis Utility (effect with stereo in/out, zero latency declared)
