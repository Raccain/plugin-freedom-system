# Parameter Specification — GrooveScout

**Status:** LOCKED — Immutable during Stages 1–5 implementation.

**CRITICAL CONTRACT:** Parameter IDs, types, ranges, and defaults defined here
are the single source of truth. Do NOT change them without updating ALL stages.

**Generated by:** UI mockup finalization (ui-finalization-agent, v2) + design revision (v3 pre-build)
**Generated date:** 2026-02-21
**Source:** v3 design decisions — see architecture.md and plan.md

---

## Total Parameter Count

**Total: 10 APVTS parameters**
- Float: 10
- Choice: 0
- Bool: 0

---

## Parameter Definitions

### Capture

---

#### captureDuration

- **ID:** `captureDuration`
- **Type:** `AudioParameterFloat`
- **Range:** 1.0 to 30.0 seconds
- **Default:** 15.0 seconds
- **Skew Factor:** linear
- **Units:** seconds
- **UI Control:** Rotary knob in record controls bar
- **DSP Usage:** When recording is active, auto-stops capture after this many seconds. User may also stop manually before the duration is reached. After BPM is detected, the UI shows an `≈ X bars` label alongside the knob value for context (JS-computed, not a parameter).

---

### Kick Detection

---

#### kickSensitivity

- **ID:** `kickSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear (no skew)
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in KICK detection card (Sens row)
- **DSP Usage:** Onset detection threshold for kick drum band. Lower values detect quieter hits; higher values require stronger transients.

---

#### kickFreqLow

- **ID:** `kickFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 20.0 to 1000.0 Hz
- **Default:** 40.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew for AudioParameterFloat NormalisableRange)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in KICK card
- **DSP Usage:** Low cutoff of kick drum bandpass detection filter. Must always be less than kickFreqHigh. Validated in DSP before use.

---

#### kickFreqHigh

- **ID:** `kickFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 20.0 to 1000.0 Hz
- **Default:** 120.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in KICK card
- **DSP Usage:** High cutoff of kick drum bandpass detection filter. Must always be greater than kickFreqLow.

---

### Snare Detection

---

#### snareSensitivity

- **ID:** `snareSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in SNARE detection card (Sens row)
- **DSP Usage:** Onset detection threshold for snare drum band. Lower = more sensitive.

---

#### snareFreqLow

- **ID:** `snareFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 100.0 to 20000.0 Hz
- **Default:** 200.0 Hz
- **Skew Factor:** logarithmic (approximately 0.25 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in SNARE card
- **DSP Usage:** Low cutoff of snare drum bandpass detection filter. Must be less than snareFreqHigh.

---

#### snareFreqHigh

- **ID:** `snareFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 100.0 to 20000.0 Hz
- **Default:** 8000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.25 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in SNARE card
- **DSP Usage:** High cutoff of snare drum bandpass detection filter. Must be greater than snareFreqLow.

---

### Hihat Detection

---

#### hihatSensitivity

- **ID:** `hihatSensitivity`
- **Type:** `AudioParameterFloat`
- **Range:** 0.0 to 1.0
- **Default:** 0.5
- **Skew Factor:** linear
- **Units:** dimensionless (normalized threshold)
- **UI Control:** Horizontal slider in HIHAT detection card (Sens row)
- **DSP Usage:** Onset detection threshold for hihat band. Lower = more sensitive.

---

#### hihatFreqLow

- **ID:** `hihatFreqLow`
- **Type:** `AudioParameterFloat`
- **Range:** 1000.0 to 20000.0 Hz
- **Default:** 5000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (low handle) in HIHAT card
- **DSP Usage:** Low cutoff of hihat bandpass detection filter. Must be less than hihatFreqHigh.

---

#### hihatFreqHigh

- **ID:** `hihatFreqHigh`
- **Type:** `AudioParameterFloat`
- **Range:** 1000.0 to 20000.0 Hz
- **Default:** 16000.0 Hz
- **Skew Factor:** logarithmic (approximately 0.4 skew)
- **Units:** Hz
- **UI Control:** Dual-handle frequency range slider (high handle) in HIHAT card
- **DSP Usage:** High cutoff of hihat bandpass detection filter. Must be greater than hihatFreqLow.

---

## Non-Parameter UI Elements

These are UI interactions and plugin state — NOT APVTS parameters.
They use the native function bridge (`window.juce.getNativeFunction`) and timer polling.

| Element | Type | C++ Integration |
|---------|------|----------------|
| REC button | Trigger | `getNativeFunction("startRecording")()` → `audioProcessor.startRecording()` |
| STOP button | Trigger | `getNativeFunction("stopCurrentOperation")()` → `audioProcessor.stopCurrentOperation()` — halts recording OR analysis, buffer always preserved |
| Duration knob | APVTS-bound | Standard slider attachment to `captureDuration` parameter |
| `≈ X bars` label | JS-computed display | JS: `if (detectedBpm > 0) label = Math.round(captureDuration / (240.0 / detectedBpm)) + " bars"` |
| Waveform display | Timer-pushed | C++ pushes downsampled RMS array every 200ms: `evaluateJavascript("updateWaveform([...])")` |
| Analyze button | Trigger | `getNativeFunction("startAnalysis")()` → `audioProcessor.startAnalysis()` — enabled only when buffer has content |
| Progress display | Timer-polled | Shows `getAnalysisProgress()` 0.0–1.0 + current step string (e.g. "Detecting BPM...") |
| BPM display | Timer-polled | Shows `getDetectedBpm()` float formatted to 1 decimal, or `?` if detection failed or not yet run |
| Key display | Timer-polled | Shows `getDetectedKey()` string (e.g. "F# minor"), or `?` if detection failed or not yet run |
| KICK Preview button | Toggle trigger | `getNativeFunction("togglePreview")("kick")` → loops recording buffer filtered through kick band; stops on second press or STOP |
| SNARE Preview button | Toggle trigger | `getNativeFunction("togglePreview")("snare")` |
| HIHAT Preview button | Toggle trigger | `getNativeFunction("togglePreview")("hihat")` |
| ROOT CHORD clip | Draggable tile | `getNativeFunction("startMidiDrag")("chord")` → drag root chord MIDI file; grayed if key is `?` |
| KICK clip | Draggable tile | `getNativeFunction("startMidiDrag")("kick")` |
| SNARE clip | Draggable tile | `getNativeFunction("startMidiDrag")("snare")` |
| HIHAT clip | Draggable tile | `getNativeFunction("startMidiDrag")("hihat")` |

---

## APVTS Registration Order

Parameters must be registered in this order in `createParameterLayout()` for
consistency across stages:

```cpp
// PluginProcessor.cpp — createParameterLayout()

// Float: Capture Duration (1)
juce::AudioParameterFloat captureDuration("captureDuration", "Capture Duration",
    juce::NormalisableRange<float>(1.0f, 30.0f), 15.0f);

// Float: Kick (3)
juce::AudioParameterFloat kickSensitivity("kickSensitivity", "Kick Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat kickFreqLow("kickFreqLow", "Kick Freq Low",
    juce::NormalisableRange<float>(20.0f, 1000.0f, 0.0f, 0.4f), 40.0f);

juce::AudioParameterFloat kickFreqHigh("kickFreqHigh", "Kick Freq High",
    juce::NormalisableRange<float>(20.0f, 1000.0f, 0.0f, 0.4f), 120.0f);

// Float: Snare (3)
juce::AudioParameterFloat snareSensitivity("snareSensitivity", "Snare Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat snareFreqLow("snareFreqLow", "Snare Freq Low",
    juce::NormalisableRange<float>(100.0f, 20000.0f, 0.0f, 0.25f), 200.0f);

juce::AudioParameterFloat snareFreqHigh("snareFreqHigh", "Snare Freq High",
    juce::NormalisableRange<float>(100.0f, 20000.0f, 0.0f, 0.25f), 8000.0f);

// Float: Hihat (3)
juce::AudioParameterFloat hihatSensitivity("hihatSensitivity", "Hihat Sensitivity",
    juce::NormalisableRange<float>(0.0f, 1.0f), 0.5f);

juce::AudioParameterFloat hihatFreqLow("hihatFreqLow", "Hihat Freq Low",
    juce::NormalisableRange<float>(1000.0f, 20000.0f, 0.0f, 0.4f), 5000.0f);

juce::AudioParameterFloat hihatFreqHigh("hihatFreqHigh", "Hihat Freq High",
    juce::NormalisableRange<float>(1000.0f, 20000.0f, 0.0f, 0.4f), 16000.0f);
```

---

## Validation Constraints

These constraints must be enforced in DSP code (not in APVTS — APVTS allows any in-range value independently):

1. `kickFreqLow < kickFreqHigh` — clamp or swap at analysis setup time
2. `snareFreqLow < snareFreqHigh` — same enforcement
3. `hihatFreqLow < hihatFreqHigh` — same enforcement
4. Minimum gap between low/high: recommend 10 Hz minimum for all bands

---

## Notes

- Parameters persist with preset save/load via APVTS serialization (automatic)
- Non-parameter state (analysis results: BPM, key, MIDI patterns, buffer content) is ephemeral — not saved in presets
- Analysis results reset when plugin is reloaded or DAW project closes
- Buffer content is not persisted — user must re-record after DAW project reload
- `getLatencySamples()` returns 0 — audio passes through unchanged (stereo passthrough)
- Plugin type: Analysis Utility (effect with stereo in/out, zero latency declared)
- BPM and Key are always detected when Analyze is run — no per-feature gating
- All three drum types (kick, snare, hihat) are always detected — no per-drum enable/disable
- Partial results are valid: if STOP is pressed mid-analysis, completed steps show results, incomplete steps show `?`
