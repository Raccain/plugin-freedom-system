# GrooveScout UI Specification v5
# Window: 750x560px fixed
# Visual: Dark neon — near-black background, cyan accent (#00e5ff)
#
# Changes from v4:
#   Change 1 — Preview Playhead in Waveform Canvas
#     - When a drum Preview button is active, the waveform canvas shows a moving playhead
#     - Played portion (left of playhead): bars at full brightness (#00e5ff, full opacity)
#     - Unplayed portion (right of playhead): bars dimmed to rgba(0,229,255,0.2)
#     - Playhead line: 1px vertical, #ffffff at opacity 0.7
#     - Playhead animates 0→1 normalized at ~0.01/100ms (≈10s loop), then wraps
#     - On loop wrap: brief full-waveform dim flash, then restart from left
#     - Non-preview states: waveform draws normally (no split, no playhead line)
#   Change 2 — Duration Knob: Smaller + Seconds Below + Record Controls Row Extended
#     - SVG reduced: 64×64px (viewBox "0 0 64 64")
#     - Knob body: 18px radius centered at (32,32)
#     - Dot ring: 26px radius from center, 20 dots, 270° sweep
#     - Dot size: 2.5px radius (inactive/active), 3px radius (active tip)
#     - Indicator line: 8px long from center outward
#     - Value label: "15s" in 13px monospace directly below SVG
#     - DURATION label: 9px #666 above SVG
#     - All three elements in a single flex-column container
#     - Record Controls row height: 64px (was 44px, +20px)
#     - Waveform: y=100, height=36px (shifted down 20px, height reduced 20px)
#     - All other rows unchanged — total window height remains 560px

window:
  width: 750
  height: 560
  resizable: false
  title: "GrooveScout"

# Layout rows (top-to-bottom):
#   Row 1 — Title Bar:          y=0,   h=36
#   Row 2 — Record Controls:    y=36,  h=64   (+20px vs v4)
#   Row 3 — Waveform Canvas:    y=100, h=36   (shifted down 20px, height reduced from 56 to 36)
#   Row 4 — Drum Detection:     y=136, h=164  (unchanged)
#   Row 5 — Action Row:         y=300, h=44   (unchanged)
#   Row 6 — Results:            y=344, h=56   (unchanged)
#   Row 7 — MIDI Clip Tiles:    y=400, h=160  (unchanged)
#   Total height: 400+160=560

layout:
  title_bar:
    y: 0
    height: 36
    border_bottom: "1px solid #1e1e1e"
    title_align: left
    version_align: right

  record_controls:
    y: 36
    height: 64
    padding_horizontal: 20
    layout: horizontal_flex
    elements:
      - rec_button
      - stop_button
      - capture_duration_knob
      - bars_hint
      - buffer_status
    note: "v5: height increased from 44 to 64px to accommodate knob + labels"

  waveform_canvas:
    y: 100
    height: 36
    border_top: "1px solid #222"
    border_bottom: "1px solid #222"
    background: "#111111"
    full_width: true
    note: "v5: y shifted +20px, height reduced from 56 to 36px; playhead overlay added for preview state"

  drum_detection_cards:
    y: 136
    height: 164
    padding_horizontal: 15
    padding_vertical: 10
    card_gap: 12
    card_width: 232
    card_height: 144
    cards:
      - name: "KICK"
        x: 15
      - name: "SNARE"
        x: 259
      - name: "HIHAT"
        x: 503

  action_row:
    y: 300
    height: 44
    padding_horizontal: 20
    layout: centered
    elements:
      - analyze_button
      - stop_button_analyzing

  progress_area:
    y: 344
    height: 0
    note: "shown only during analyzing state — overlaps top of results row"

  results:
    y: 344
    height: 56
    padding_horizontal: 20
    layout: two_column_equal
    border_top: "1px solid #1a1a1a"

  midi_clips:
    y: 400
    height: 160
    padding_horizontal: 20
    gap: 10
    tile_width: 170
    tile_height: 140
    border_top: "1px solid #1a1a1a"

# APVTS-bound controls (10 parameters total)
controls:
  # captureDuration — arc dot-ring SVG knob (1–30s, default 15s)
  - id: capture_duration
    type: slider
    label: "DURATION"
    position: { x: 154, y: 50 }
    size: { width: 64, height: 64 }
    range: [1.0, 30.0]
    default: 15.0
    orientation: rotary
    unit: "s"
    group: record_controls
    note: "v5: SVG reduced to 64x64; body radius 18px; 20 dots; 26px ring; indicator 8px; value label 13px below; DURATION label 9px above"

  # --- Kick card controls ---
  - id: kick_sensitivity
    type: slider
    label: "SENS"
    position: { x: 15, y: 236 }
    size: { width: 232, height: 20 }
    range: [0.0, 1.0]
    default: 0.5
    orientation: horizontal
    group: kick_card

  - id: kick_freq_low
    type: slider
    label: "FREQ LOW"
    position: { x: 15, y: 190 }
    size: { width: 232, height: 20 }
    range: [20.0, 1000.0]
    default: 40.0
    scale: logarithmic
    orientation: horizontal
    group: kick_card

  - id: kick_freq_high
    type: slider
    label: "FREQ HIGH"
    position: { x: 15, y: 190 }
    size: { width: 232, height: 20 }
    range: [20.0, 1000.0]
    default: 120.0
    scale: logarithmic
    orientation: horizontal
    group: kick_card
    note: "dual-handle with kick_freq_low — same track, same row"

  # --- Snare card controls ---
  - id: snare_sensitivity
    type: slider
    label: "SENS"
    position: { x: 259, y: 236 }
    size: { width: 232, height: 20 }
    range: [0.0, 1.0]
    default: 0.5
    orientation: horizontal
    group: snare_card

  - id: snare_freq_low
    type: slider
    label: "FREQ LOW"
    position: { x: 259, y: 190 }
    size: { width: 232, height: 20 }
    range: [100.0, 20000.0]
    default: 200.0
    scale: logarithmic
    orientation: horizontal
    group: snare_card

  - id: snare_freq_high
    type: slider
    label: "FREQ HIGH"
    position: { x: 259, y: 190 }
    size: { width: 232, height: 20 }
    range: [100.0, 20000.0]
    default: 8000.0
    scale: logarithmic
    orientation: horizontal
    group: snare_card
    note: "dual-handle with snare_freq_low"

  # --- Hihat card controls ---
  - id: hihat_sensitivity
    type: slider
    label: "SENS"
    position: { x: 503, y: 236 }
    size: { width: 232, height: 20 }
    range: [0.0, 1.0]
    default: 0.5
    orientation: horizontal
    group: hihat_card

  - id: hihat_freq_low
    type: slider
    label: "FREQ LOW"
    position: { x: 503, y: 190 }
    size: { width: 232, height: 20 }
    range: [1000.0, 20000.0]
    default: 5000.0
    scale: logarithmic
    orientation: horizontal
    group: hihat_card

  - id: hihat_freq_high
    type: slider
    label: "FREQ HIGH"
    position: { x: 503, y: 190 }
    size: { width: 232, height: 20 }
    range: [1000.0, 20000.0]
    default: 16000.0
    scale: logarithmic
    orientation: horizontal
    group: hihat_card
    note: "dual-handle with hihat_freq_low"

# Non-parameter UI elements (actions / state displays)
ui_elements:
  - id: rec_button
    type: action_button
    label: "● REC"
    style: pill_accent_border
    position: { x: 20, y: 54 }
    size: { width: 72, height: 28 }
    states:
      idle: { enabled: true, label: "● REC", style: accent_border }
      recording: { enabled: true, label: "● REC", style: accent_fill_glow }
      buffer_ready: { enabled: true, label: "● REC", style: accent_border }
      analyzing: { enabled: false, label: "● REC", style: dimmed }
      complete: { enabled: true, label: "● REC", style: accent_border }

  - id: stop_button_record
    type: action_button
    label: "■ STOP"
    style: pill_warning_border
    position: { x: 100, y: 54 }
    size: { width: 72, height: 28 }
    visible_states: [recording]
    note: "hidden unless recording"

  - id: capture_duration_knob
    type: rotary_display
    implementation: svg_dot_ring
    label_above: "DURATION"
    label_above_size: 9px
    label_above_color: "#666666"
    value_below: "15s"
    value_below_size: 13px
    value_below_color: "#ffffff"
    center: { x: 218, y: 68 }
    diameter: 36
    dot_ring:
      num_dots: 20
      sweep_degrees: 270
      start_angle_degrees: 135
      dot_radius_px: 2.5
      dot_ring_radius_px: 26
      color_inactive: "#333333"
      color_active: "#00e5ff"
      glow_active: "0 0 4px rgba(0,229,255,0.8)"
      tip_dot_radius_px: 3
    indicator:
      length_px: 8
    interaction:
      type: vertical_drag
      sensitivity: 0.3
      reset_on_double_click: 15.0
    cursor: ns-resize
    note: "v5: SVG 64x64, body 18px radius, 20 dots, 26px ring, 8px indicator, 13px value label below"

  - id: bars_hint
    type: label
    label: "≈ 8 bars"
    font_size: 11px
    color: "#888888"
    position: { x: 265, y: 64 }
    visible_states: [buffer_ready, analyzing, complete, partial]
    note: "hidden when detectedBPM is 0 (before analysis)"

  - id: buffer_status
    type: label
    font_size: 11px
    color: "#aaaaaa"
    label: "BUFFER EMPTY"
    position: { x: 490, y: 64 }
    states:
      idle: "BUFFER EMPTY"
      recording: "RECORDING..."
      buffer_ready: "BUFFER READY"
      analyzing: "BUFFER READY"
      complete: "BUFFER READY"
      partial: "BUFFER READY"

  - id: waveform_display
    type: canvas
    position: { x: 0, y: 100 }
    size: { width: 750, height: 36 }
    states:
      empty: "flat center line + dim placeholder text"
      recording: "left-to-right cyan bars filling as audio arrives (no playhead)"
      ready: "full waveform at normal opacity"
      previewing: "split waveform with moving playhead overlay"
    note: "v5: playhead overlay — bright played zone left, dim unplayed zone right, 1px white line at cursor"
    preview_playhead:
      variable: previewPlayhead
      range: [0.0, 1.0]
      played_color: "#00e5ff"
      played_opacity: 1.0
      unplayed_color: "rgba(0,229,255,0.2)"
      playhead_line_color: "#ffffff"
      playhead_line_opacity: 0.7
      playhead_line_width_px: 1
      advance_per_100ms: 0.01
      on_wrap: "brief full-waveform dim flash then restart"

  - id: preview_kick
    type: toggle_button
    label: "▶ PREVIEW"
    label_active: "■ STOP PREVIEW"
    position: { x: 15, y: 262 }
    size: { width: 232, height: 22 }
    disabled_states: [idle]

  - id: preview_snare
    type: toggle_button
    label: "▶ PREVIEW"
    label_active: "■ STOP PREVIEW"
    position: { x: 259, y: 262 }
    size: { width: 232, height: 22 }
    disabled_states: [idle]

  - id: preview_hihat
    type: toggle_button
    label: "▶ PREVIEW"
    label_active: "■ STOP PREVIEW"
    position: { x: 503, y: 262 }
    size: { width: 232, height: 22 }
    disabled_states: [idle]

  - id: analyze_button
    type: action_button
    label: "ANALYZE"
    style: rect_accent
    position: { x: 275, y: 308 }
    size: { width: 200, height: 30 }
    disabled_states: [idle, recording]

  - id: stop_button_analyze
    type: action_button
    label: "■ STOP"
    style: pill_warning_border
    position: { x: 487, y: 308 }
    size: { width: 72, height: 30 }
    visible_states: [analyzing]

  - id: progress_bar
    type: progress_bar
    position: { x: 0, y: 336 }
    size: { width: 750, height: 4 }
    visible_states: [analyzing]

  - id: progress_step_label
    type: label
    label: "Detecting BPM..."
    font_size: 12px
    color: "#cccccc"
    position: { x: 0, y: 341 }
    size: { width: 750, height: 14 }
    align: center
    visible_states: [analyzing]

  - id: bpm_display
    type: clickable_label
    font_size: 32px
    color_active: "#ffffff"
    color_placeholder: "#3a3a3a"
    position: { x: 20, y: 356 }
    size: { width: 335, height: 36 }
    states:
      placeholder: "--"
      active: "124.0"
      failed: "?"
    action: set_daw_tempo

  - id: key_display
    type: label
    font_size: 18px
    color_active: "#ffffff"
    color_placeholder: "#3a3a3a"
    position: { x: 395, y: 356 }
    size: { width: 335, height: 36 }
    states:
      placeholder: "--"
      active: "F# minor"
      failed: "?"

  - id: midi_tile_chord
    type: midi_drag_tile
    label: "ROOT CHORD"
    position: { x: 20, y: 408 }
    size: { width: 170, height: 132 }

  - id: midi_tile_kick
    type: midi_drag_tile
    label: "KICK"
    position: { x: 200, y: 408 }
    size: { width: 170, height: 132 }

  - id: midi_tile_snare
    type: midi_drag_tile
    label: "SNARE"
    position: { x: 380, y: 408 }
    size: { width: 170, height: 132 }

  - id: midi_tile_hihat
    type: midi_drag_tile
    label: "HIHAT"
    position: { x: 560, y: 408 }
    size: { width: 170, height: 132 }

styling:
  colors:
    background: "#0f0f0f"
    surface: "#181818"
    surface_raised: "#1a1a1a"
    border: "#222222"
    border_active: "#00e5ff"
    accent: "#00e5ff"
    accent_dim: "#00b8cc"
    text_primary: "#ffffff"
    text_secondary: "#e8e8e8"
    text_label: "#666666"
    text_value: "#cccccc"
    text_muted: "#aaaaaa"
    inactive_fill: "#2a2a2a"
    warning: "#ff6b6b"

  fonts:
    values: "'JetBrains Mono', 'IBM Plex Mono', 'Fira Mono', monospace"
    labels: "'Inter', 'DM Sans', 'Helvetica Neue', system-ui, sans-serif"
    title: "'Inter', 'DM Sans', system-ui, sans-serif"

  effects:
    accent_glow: "0 0 8px rgba(0,229,255,0.6), 0 0 20px rgba(0,229,255,0.2)"
    accent_glow_strong: "0 0 12px rgba(0,229,255,0.9), 0 0 30px rgba(0,229,255,0.4)"
    card_shadow: "inset 0 1px 0 rgba(255,255,255,0.04)"
    dot_glow: "0 0 4px rgba(0,229,255,0.8)"

  typography:
    freq_end_labels:
      font_size: 11px
      color: "#cccccc"
    sensitivity_value:
      font_size: 11px
      color: "#cccccc"
    bpm_value:
      font_size: 32px
      color: "#ffffff"
      font_family: monospace
    key_value:
      font_size: 18px
      color: "#ffffff"
    capture_value:
      font_size: 13px
      color: "#ffffff"
      note: "v5: reduced from 14px to 13px for compact knob group"
    progress_step:
      font_size: 12px
      color: "#cccccc"
    buffer_status:
      font_size: 11px
      color: "#aaaaaa"
    bars_hint:
      font_size: 11px
      color: "#888888"
    card_title:
      font_size: 11px
      color: "#00e5ff"
      uppercase: true

  freq_range_sliders:
    implementation: div_track_with_absolute_handles
    drag_model: document_mousemove_mouseup
    scale: logarithmic
    handle_min_gap_px: 10
    handle_diameter_px: 13
    track_height_px: 3
    fill_color: "rgba(0,229,255,0.45)"
    handle_color: "#00b8cc"
    handle_active_color: "#00e5ff"
